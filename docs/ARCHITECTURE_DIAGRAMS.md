# ๐๏ธ DolarGaucho - Diagramas de Arquitectura

## ๐ Flujo Completo de Datos

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                          USUARIO                                      โ
โ                     (Abre /dashboard)                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                                 โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    NEXT.JS SERVER                                     โ
โ  1. Server-Side Rendering (SSR)                                      โ
โ  2. Genera HTML inicial                                              โ
โ  3. Envรญa al browser                                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                                 โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    REACT (Client Side)                                โ
โ  1. Hidrata el HTML                                                  โ
โ  2. Monta componentes                                                โ
โ  3. Ejecuta useEffect y hooks                                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                                 โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    TANSTACK QUERY (React Query)                       โ
โ                                                                       โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ            โ
โ  โ  useDolarQuery() se ejecuta                         โ            โ
โ  โ  queryKey: ['dolar']                                โ            โ
โ  โ  queryFn: fetchDolar                                โ            โ
โ  โโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ            โ
โ                        โ                                             โ
โ                        โผ                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ            โ
โ  โ  ยฟHay datos en cache?                               โ            โ
โ  โ                                                      โ            โ
โ  โ  Sร โ ยฟSon frescos (< 30s)?                         โ            โ
โ  โ       โโ Sร โ Devolver del cache                    โ            โ
โ  โ       โโ NO โ Fetch en background + devolver cache  โ            โ
โ  โ                                                      โ            โ
โ  โ  NO โ Fetch inmediato                               โ            โ
โ  โโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    EXTERNAL APIs                                      โ
โ                                                                       โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ               โ
โ  โ  fetch('https://dolarapi.com/v1/dolares')        โ               โ
โ  โ  โ                                                โ               โ
โ  โ  Response: [                                      โ               โ
โ  โ    { casa: "blue", venta: 1170, ... },           โ               โ
โ  โ    { casa: "oficial", venta: 900, ... },         โ               โ
โ  โ    ...                                            โ               โ
โ  โ  ]                                                โ               โ
โ  โโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    TANSTACK QUERY (Cache)                             โ
โ                                                                       โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ               โ
โ  โ  Guarda en cache con:                            โ               โ
โ  โ  - queryKey: ['dolar']                           โ               โ
โ  โ  - data: [...]                                   โ               โ
โ  โ  - timestamp: Date.now()                         โ               โ
โ  โ  - staleTime: 30000ms                            โ               โ
โ  โโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    REACT COMPONENT RE-RENDER                          โ
โ                                                                       โ
โ  const { data: dolares } = useDolarQuery();                          โ
โ  // dolares ahora tiene los datos                                   โ
โ                                                                       โ
โ  return (                                                            โ
โ    <div>                                                             โ
โ      {dolares.map(dolar => (                                         โ
โ        <DolarCard key={dolar.casa} dolar={dolar} />                 โ
โ      ))}                                                             โ
โ    </div>                                                            โ
โ  )                                                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                                 โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    ZUSTAND STORES (Estado Global)                     โ
โ                                                                       โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ               โ
โ  โ  useFavoritesStore()                             โ               โ
โ  โ  โ                                                โ               โ
โ  โ  ยฟEste dรณlar estรก en favoritos?                  โ               โ
โ  โ  โโ Sร โ Mostrar con estrella amarilla           โ               โ
โ  โ  โโ NO โ Mostrar con estrella gris               โ               โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ               โ
โ                                                                       โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ               โ
โ  โ  useAlertasStore()                               โ               โ
โ  โ  โ                                                โ               โ
โ  โ  ยฟHay alerta para este dรณlar?                    โ               โ
โ  โ  โโ Sร โ Chequear si se cumple condiciรณn         โ               โ
โ  โ  โ        โโ Sร โ Disparar notificaciรณn          โ               โ
โ  โ  โ        โโ NO โ No hacer nada                  โ               โ
โ  โ  โโ NO โ No hacer nada                           โ               โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                                 โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    BROWSER (Final Render)                             โ
โ                                                                       โ
โ  Usuario ve:                                                         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ         โ
โ  โ  ๐ต Dรณlar Blue        โญ (favorito)                     โ         โ
โ  โ  Venta: $1.170,00    โฒ +2,5%                          โ         โ
โ  โ  ๐ Alerta: Activa                                     โ         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                                 โ (Cada 30 segundos)
                                 โ
                                 โผ
                    [Refetch automรกtico en background]
                                 โ
                                 โโโโโโโโโโโ
                                           โ
                           (Volver a fetch desde APIs)
```

---

## ๐ Ciclo de Vida de React Query

```
INICIO
  โ
  โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  useQuery se ejecuta por primera vez        โ
โ  queryKey: ['dolar']                        โ
โ  status: 'pending'                          โ
โ  isLoading: true                            โ
โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                 โ
                 โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  queryFn se ejecuta (fetchDolar)            โ
โ  fetch a API...                             โ
โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                 โ
         โโโโโโโโโดโโโโโโโโ
         โ               โ
         โผ               โผ
    โ SUCCESS      โ ERROR
         โ               โ
         โ               โผ
         โ      โโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ      โ  status: 'error'        โ
         โ      โ  error: Error object    โ
         โ      โ  retry: true            โ
         โ      โ  retryCount: 1          โ
         โ      โโโโโโโโโโฌโโโโโโโโโโโโโโโโโ
         โ               โ
         โ               โผ
         โ      (Retry 2 veces mรกs)
         โ               โ
         โ               โผ
         โ      (Si falla 3 veces โ mostrar error)
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  status: 'success'                          โ
โ  data: [...]                                โ
โ  isLoading: false                           โ
โ  isSuccess: true                            โ
โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                 โ
                 โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Guardar en cache                           โ
โ  - Key: ['dolar']                           โ
โ  - Data: [...]                              โ
โ  - Timestamp: now                           โ
โ  - staleTime: 30000ms                       โ
โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                 โ
                 โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Component re-render                        โ
โ  Mostrar datos al usuario                   โ
โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                 โ
                 โผ
      โฐ Esperar 30 segundos
                 โ
                 โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  refetchInterval triggered                  โ
โ  status: 'success' (mantiene datos viejos)  โ
โ  isFetching: true (fetch en background)     โ
โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                 โ
                 โผ
         Fetch en background
                 โ
                 โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Nuevos datos llegan                        โ
โ  Compare con cache anterior                 โ
โ  ยฟSon diferentes?                           โ
โ    Sร โ Re-render component                 โ
โ    NO โ No hacer nada (optimizaciรณn)        โ
โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                 โ
                 โโโโโโโโโโโโโ
                             โ
                    (Loop infinito)
                             โ
                             โผ
              โฐ Esperar 30 segundos
                             โ
                             โโโโโโโ> (Repetir refetch)
```

---

## ๐๏ธ Arquitectura de Zustand Store

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    ZUSTAND STORE                                โ
โ                   (Estado Global)                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                           โ
           โโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโ
           โ               โ               โ
           โผ               โผ               โผ
    โโโโโโโโโโโโ    โโโโโโโโโโโโ    โโโโโโโโโโโโ
    โ ESTADO   โ    โ ACTIONS  โ    โ PERSIST  โ
    โ (state)  โ    โ (setters)โ    โ (storage)โ
    โโโโโโโโโโโโ    โโโโโโโโโโโโ    โโโโโโโโโโโโ
           โ               โ               โ
           โ               โ               โ
           โผ               โผ               โผ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  FAVORITES STORE (lib/store/favorites.ts)                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                   โ
โ  ESTADO:                                                         โ
โ  โโ dolares: string[]      โ ['blue', 'oficial']                โ
โ  โโ currencies: string[]   โ ['USD', 'EUR']                     โ
โ  โโ cryptos: string[]      โ ['bitcoin', 'ethereum']            โ
โ                                                                   โ
โ  ACTIONS:                                                        โ
โ  โโ toggleDolar(id)                                             โ
โ  โ  โโ> Si existe โ remover                                     โ
โ  โ      Si no existe โ agregar                                  โ
โ  โ                                                               โ
โ  โโ toggleCurrency(id)                                          โ
โ  โ  โโ> (mismo logic)                                           โ
โ  โ                                                               โ
โ  โโ toggleCrypto(id)                                            โ
โ  โ  โโ> (mismo logic)                                           โ
โ  โ                                                               โ
โ  โโ getTotalCount()                                             โ
โ     โโ> return dolares.length + currencies.length + cryptos.length
โ                                                                   โ
โ  PERSIST:                                                        โ
โ  โโ localStorage key: 'favorites'                               โ
โ     โโ> Guarda automรกticamente en cada cambio                   โ
โ         Lee automรกticamente al cargar                            โ
โ                                                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

EJEMPLO DE USO:

// En cualquier componente:
const { dolares, toggleDolar } = useFavoritesStore();

// Chequear si estรก en favoritos:
const isFavorite = dolares.includes('blue');

// Toggle favorito:
<button onClick={() => toggleDolar('blue')}>
  {isFavorite ? 'โญ' : 'โ'}
</button>

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  FLUJO COMPLETO:                                                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                     โ
โ  1. Usuario clickea estrella                                       โ
โ     โ                                                              โ
โ  2. toggleDolar('blue') se ejecuta                                 โ
โ     โ                                                              โ
โ  3. Zustand actualiza state:                                       โ
โ     dolares: [] โ ['blue']                                         โ
โ     โ                                                              โ
โ  4. Persist middleware guarda en localStorage:                     โ
โ     localStorage.setItem('favorites', JSON.stringify({ dolares: ['blue'] }))
โ     โ                                                              โ
โ  5. Todos los componentes que usan useFavoritesStore() se re-renderizan
โ     โ                                                              โ
โ  6. Estrella cambia de โ a โญ                                      โ
โ                                                                     โ
โ  [Usuario cierra tab]                                              โ
โ                                                                     โ
โ  [Usuario reabre tab]                                              โ
โ     โ                                                              โ
โ  7. Zustand lee localStorage automรกticamente                       โ
โ     โ                                                              โ
โ  8. Favoritos restaurados: dolares = ['blue']                     โ
โ     โ                                                              โ
โ  9. UI muestra estrella llena โญ desde el inicio                   โ
โ                                                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐จ Component Hierarchy

```
pages/_app.tsx
โ
โโ QueryClientProvider (TanStack Query)
โ  โ
โ  โโ AuthProvider (Supabase Auth)
โ  โ  โ
โ  โ  โโ ThemeProvider (Dark Mode)
โ  โ     โ
โ  โ     โโ [Current Page]
โ  โ
โ  โโ ReactQueryDevtools (solo dev)
โ

pages/dashboard/index.tsx
โ
โโ DashboardLayout
โ  โ
โ  โโ UnifiedNavbar
โ  โ  โ
โ  โ  โโ Logo + Link to home
โ  โ  โ
โ  โ  โโ Right Actions
โ  โ  โ  โโ RiesgoPaisBadge
โ  โ  โ  โโ ThemeToggle
โ  โ  โ  โโ Search Button
โ  โ  โ  โโ Menu Toggle
โ  โ  โ
โ  โ  โโ Search Bar (expandible)
โ  โ  โ
โ  โ  โโ Mobile Menu (sidebar)
โ  โ     โโ Logo Header
โ  โ     โโ Menu Items
โ  โ     โ  โโ Dashboard
โ  โ     โ  โโ Criptomonedas (NUEVO)
โ  โ     โ  โโ Anรกlisis
โ  โ     โ  โโ Polรญtica
โ  โ     โ  โโ Finanzas
โ  โ     โ  โโ Calculadoras
โ  โ     โ  โโ Alertas
โ  โ     โ  โโ Calendario
โ  โ     โ
โ  โ     โโ Footer
โ  โ        โโ Quick Stats
โ  โ        โ  โโ Favoritos (clickeable โ /dashboard/favoritos)
โ  โ        โ  โโ Alertas (clickeable โ /dashboard/alertas)
โ  โ        โ
โ  โ        โโ User Info
โ  โ           โโ Avatar
โ  โ           โโ Name + Email
โ  โ           โโ Logout Button
โ  โ
โ  โโ DolarMarquee (ticker horizontal)
โ
โโ Hero Section (Multimedia Placeholder)
โ  โโ Icon/Image
โ  โโ Title
โ  โโ Description
โ
โโ Favorites Section
โ  โโ Grid de favoritos
โ  โ  โโ DolarCard (si hay dรณlares favoritos)
โ  โ  โโ CurrencyCard (si hay monedas favoritas)
โ  โ  โโ CryptoCard (si hay cryptos favoritas)
โ  โ
โ  โโ EmptyState (si no hay favoritos)
โ
โโ Quick Access Cards
โ  โโ Link to Calculadoras
โ  โโ Link to Crypto
โ  โโ Link to Anรกlisis
โ  โโ Link to Polรญtica
โ
โโ Cotizaciones Destacadas
โ  โโ Dรณlar Blue
โ  โโ Dรณlar Oficial
โ  โโ Dรณlar MEP
โ
โโ Recent Activity
   โโ รltimas alertas disparadas
```

---

## ๐ API Call Flow

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    MULTIPLE CONCURRENT FETCHES                   โ
โ           (Todo en paralelo para mรกxima velocidad)               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

DASHBOARD PRINCIPAL carga TODO en paralelo:

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                     โ
โ   useDolarQuery()                                                  โ
โ   โโ fetch('https://dolarapi.com/v1/dolares')                     โ
โ   โโ Time: ~500ms                                                 โ
โ                                                                     โ
โ   useCryptoQuery()                                                 โ
โ   โโ fetch('https://api.coingecko.com/api/v3/coins/markets')      โ
โ   โโ Time: ~700ms                                                 โ
โ                                                                     โ
โ   useCotizaciones() [monedas internacionales]                     โ
โ   โโ fetch('https://api.bluelytics.com.ar/v2/latest')             โ
โ   โโ Time: ~600ms                                                 โ
โ                                                                     โ
โ   useRiesgoPais()                                                  โ
โ   โโ fetch('https://api.argentinadatos.com/v1/finanzas/indices')  โ
โ   โโ Time: ~400ms                                                 โ
โ                                                                     โ
โ   useAlertasStore() [desde localStorage]                          โ
โ   โโ Time: ~1ms (instantรกneo)                                     โ
โ                                                                     โ
โ   useFavoritesStore() [desde localStorage]                        โ
โ   โโ Time: ~1ms (instantรกneo)                                     โ
โ                                                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

RESULTADO: ~700ms total (no 500+700+600+400 = 2200ms)
           โ
    TODO carga EN PARALELO
           โ
    Tiempo total = fetch mรกs lento (700ms crypto)

PรGINA DE CALCULADORAS carga datos adicionales:

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                     โ
โ   (Hereda dรณlar y crypto del cache de React Query)                โ
โ   โโ Time: ~0ms (instantรกneo desde cache)                         โ
โ                                                                     โ
โ   useFredData() [primera vez]                                      โ
โ   โโ fetch 7 series en paralelo                                   โ
โ   โ  โโ FEDFUNDS                                                  โ
โ   โ  โโ CPIAUCSL                                                  โ
โ   โ  โโ GDPC1                                                     โ
โ   โ  โโ UNRATE                                                    โ
โ   โ  โโ DGS10                                                     โ
โ   โ  โโ M2SL                                                      โ
โ   โ  โโ DTWEXBGS                                                  โ
โ   โโ Time: ~1500ms (FRED es mรกs lento)                            โ
โ                                                                     โ
โ   useInflacion() [inflaciรณn Argentina]                            โ
โ   โโ fetch('https://api.argentinadatos.com/v1/inflacion')         โ
โ   โโ Time: ~500ms                                                 โ
โ                                                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

RESULTADO: ~1500ms solo para datos nuevos
           Datos ya existentes: 0ms (desde cache)
```

---

## ๐ Authentication Flow (Supabase)

```
REGISTRO:

Usuario โ Form de registro
   โ
   email: "user@example.com"
   password: "********"
   name: "Juan Pรฉrez"
   โ
supabase.auth.signUp({ email, password })
   โ
Supabase crea usuario
   โ
Supabase envรญa email de confirmaciรณn
   โ
Usuario clickea link en email
   โ
Supabase confirma email
   โ
Usuario puede hacer login

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

LOGIN:

Usuario โ Form de login
   โ
   email: "user@example.com"
   password: "********"
   โ
supabase.auth.signInWithPassword({ email, password })
   โ
Supabase valida credenciales
   โ
   โโ โ Vรกlidas
   โ  โ
   โ  Supabase devuelve:
   โ  {
   โ    user: { id, email, ... },
   โ    session: { access_token, refresh_token, ... }
   โ  }
   โ  โ
   โ  AuthContext guarda user en state
   โ  โ
   โ  Browser guarda tokens en localStorage (automรกtico)
   โ  โ
   โ  Redirect a /dashboard
   โ
   โโ โ Invรกlidas
      โ
      Error: "Invalid credentials"
      โ
      Mostrar mensaje al usuario

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

SESSION PERSISTENCE:

Usuario cierra tab
   โ
[Tokens guardados en localStorage]
   โ
Usuario reabre tab
   โ
AuthContext se monta
   โ
supabase.auth.getSession()
   โ
Lee tokens de localStorage
   โ
   โโ โ Tokens vรกlidos
   โ  โ
   โ  Restaurar sesiรณn automรกticamente
   โ  โ
   โ  Usuario sigue logueado
   โ
   โโ โ Tokens expirados
      โ
      Intentar refresh con refresh_token
      โ
      โโ โ Refresh exitoso
      โ  โ
      โ  Nuevos tokens
      โ  โ
      โ  Usuario sigue logueado
      โ
      โโ โ Refresh fallรณ
         โ
         Logout automรกtico
         โ
         Redirect a /login

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

PROTECTED ROUTES:

Usuario intenta acceder a /dashboard
   โ
ProtectedRoute component chequea:
   โ
ยฟHay usuario en AuthContext?
   โ
   โโ Sร
   โ  โ
   โ  Permitir acceso
   โ  โ
   โ  Renderizar /dashboard
   โ
   โโ NO
      โ
      Redirect a /login
      โ
      Guardar URL original: /dashboard
      โ
      [Usuario hace login]
      โ
      Redirect de vuelta a /dashboard
```

---

## ๐ฆ Bundle Structure (Next.js Build Output)

```
.next/
โโโ static/
โ   โโโ chunks/
โ   โ   โโโ app/                    # App router chunks
โ   โ   โโโ pages/                  # Pages router chunks
โ   โ   โ   โโโ dashboard/
โ   โ   โ   โ   โโโ index-[hash].js           # Dashboard page
โ   โ   โ   โ   โโโ calculadoras-[hash].js    # Calculadoras page
โ   โ   โ   โ   โโโ crypto-[hash].js          # Crypto page
โ   โ   โ   โ   โโโ ...
โ   โ   โ   โโโ _app-[hash].js               # App wrapper
โ   โ   โโโ main-[hash].js          # React + Next.js runtime
โ   โ   โโโ webpack-[hash].js       # Webpack runtime
โ   โ   โโโ framework-[hash].js     # React framework
โ   โ
โ   โโโ css/
โ       โโโ [hash].css              # Tailwind + custom CSS
โ
โโโ server/
    โโโ pages/                      # Server-rendered pages
        โโโ dashboard/
            โโโ index.html          # Pre-rendered HTML

OPTIMIZACIONES AUTOMรTICAS DE NEXT.JS:

1. Code Splitting:
   - Cada pรกgina es un bundle separado
   - Solo se carga cรณdigo de la pรกgina actual
   - Navegaciรณn a otra pรกgina โ lazy load su bundle

2. Tree Shaking:
   - Elimina cรณdigo no usado
   - Ejemplo: Si importas { Button } de ui/,
             solo Button se incluye (no todo ui/)

3. Image Optimization:
   - next/image optimiza automรกticamente
   - Genera WebP + mรบltiples tamaรฑos
   - Lazy loading por default

4. Font Optimization:
   - next/font/google optimiza Google Fonts
   - Self-host automรกtico (mejor performance)
   - No hace request externo a Google

EJEMPLO PRรCTICO:

Usuario visita /dashboard
   โ
Se carga:
   โโ main.js (220KB)         # React + Next.js
   โโ framework.js (180KB)    # Framework
   โโ app.js (50KB)           # _app wrapper
   โโ index.js (80KB)         # Dashboard page
   โโ styles.css (120KB)      # Tailwind CSS
   โ
TOTAL: ~650KB (con gzip: ~180KB)

Usuario navega a /dashboard/calculadoras
   โ
NO se recarga:
   โโ main.js
   โโ framework.js
   โโ app.js
   โโ styles.css
   โ
SOLO se carga:
   โโ calculadoras.js (95KB con gzip: ~25KB)
   โ
TOTAL adicional: 25KB
```

---

## ๐ Performance Optimization Strategy

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    PERFORMANCE STACK                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                      โ
โ  LAYER 1: NETWORK (Fastest)                                         โ
โ  โโ React Query Cache (staleTime: 30s)                             โ
โ  โ  โโ Si data es fresca โ 0ms, no network request                 โ
โ  โ                                                                   โ
โ  โโ Browser Cache (API responses)                                   โ
โ  โ  โโ Cache-Control headers                                        โ
โ  โ                                                                   โ
โ  โโ CDN Edge Cache (Vercel Edge Network)                           โ
โ     โโ Static assets servidos desde edge mรกs cercano               โ
โ                                                                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                      โ
โ  LAYER 2: RENDERING (Fast)                                          โ
โ  โโ Static Generation (build time)                                  โ
โ  โ  โโ Landing page pre-renderizada                                โ
โ  โ                                                                   โ
โ  โโ Incremental Static Regeneration                                โ
โ  โ  โโ Re-generar static pages cada X tiempo                       โ
โ  โ                                                                   โ
โ  โโ Server-Side Rendering (on-demand)                              โ
โ     โโ Dashboard pages renderizadas en server                       โ
โ                                                                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                      โ
โ  LAYER 3: BUNDLE SIZE (Medium)                                      โ
โ  โโ Code Splitting (automรกtico por Next.js)                        โ
โ  โ  โโ Cada pรกgina es un chunk separado                            โ
โ  โ                                                                   โ
โ  โโ Dynamic Imports (lazy loading)                                  โ
โ  โ  โโ Componentes pesados cargan on-demand                        โ
โ  โ                                                                   โ
โ  โโ Tree Shaking                                                    โ
โ  โ  โโ Eliminar cรณdigo no usado                                    โ
โ  โ                                                                   โ
โ  โโ Minification + Compression                                      โ
โ     โโ Terser (JS) + cssnano (CSS) + gzip                          โ
โ                                                                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                      โ
โ  LAYER 4: RUNTIME (Slower)                                          โ
โ  โโ React.memo() para componentes puros                            โ
โ  โ  โโ No re-renderizar si props no cambiaron                      โ
โ  โ                                                                   โ
โ  โโ useMemo() para cรกlculos caros                                  โ
โ  โ  โโ> const sorted = useMemo(() => data.sort(), [data])          โ
โ  โ                                                                   โ
โ  โโ useCallback() para funciones estables                          โ
โ  โ  โโ> const onClick = useCallback(() => {...}, [deps])           โ
โ  โ                                                                   โ
โ  โโ Virtualization para listas largas                              โ
โ     โโ> react-window o react-virtualized                           โ
โ                                                                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

MEJORAS IMPLEMENTADAS:

โ React Query cache con staleTime
โ Code splitting por pรกgina
โ Image optimization (next/image)
โ Font optimization (next/font)
โ Tailwind CSS purge (elimina clases no usadas)
โ Refetch en background (no bloquea UI)

MEJORAS PENDIENTES:

โณ Lazy load de Chart.js (solo cargar cuando se necesita)
โณ Virtualization en tablas de senadores/diputados (si >100 rows)
โณ Service Worker para offline support
โณ Prefetch de pรกginas en hover (next/link hace esto automรกtico)
```

---

**รltima actualizaciรณn**: 2025-01-13
**Versiรณn**: 1.0

*Estos diagramas son living documents - actualizar cuando la arquitectura cambie*
